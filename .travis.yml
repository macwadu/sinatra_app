install: true

sudo: required
dist: trusty

env:
  global:
    - "DEPLOY=false"

before_install:
  - sudo apt-get -qq update
  
script:
  echo "SUCCESS"

after_success:
  - if [ "$TRAVIS_BRANCH" == "master" ]; then
    echo "NOT DOING ANYTHING"
  else
    export DEPLOY=true;
    echo "AFTER SUCCESS DO DEPLOY"
  fi

before_deploy:
  - test $TRAVIS_TEST_RESULT = 0 && $DEPLOY = true && \# check that build passed
    && sudo apt-get -qq update
    && sudo apt-get install -y tar

    && wget https://github.com/rancher/rancher-compose/releases/download/v0.8.6/rancher-compose-linux-amd64-v0.8.6.tar.gz -O rancher-compose.tar.gz
    && tar zxvf rancher-compose.tar.gz --strip-components 2
    && rm -rf rancher-compose.tar.gz
    && sudo mv rancher-compose /usr/bin/rancher-compose
    && sudo chmod +x /usr/bin/rancher-compose

  - rancher-compose -v

deploy:
  provider: script
  on:
    condition: $DEPLOY = true
  script: echo "DEPLOYING"
